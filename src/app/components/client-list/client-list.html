<div class="clients-page">
  <div class="search-section">
    <div class="search-filters">
      <span class="filter-label">Trouver Par:</span>
      <div class="filter-buttons">
        <button *ngFor="let option of filterOptions" class="filter-btn" [class.active]="searchFilter === option"
          (click)="searchFilter = option; applyFilter()"> {{ option }}
        </button>
      </div>
    </div>

    <div class="search-input-wrapper">
      <input type="text" class="search-input" placeholder="Votre Criteres..." [(ngModel)]="searchValue"
        (input)="applyFilter()"> <button class="search-btn" (click)="applyFilter()">Rechercher</button>
    </div>
  </div>
</div>

<!-- Client Cards Grid -->
<div class="client-grid">
  <!-- Add Client Card -->
  <div class="client-card add-client-card" (click)="onAddClient()">
    <div class="add-icon-wrapper">
      <div class="add-icon">+</div>
    </div>
    <p class="add-text">Ajouter Un Client</p>
  </div>

  <!-- Client Cards -->
  <div class="client-card" *ngFor="let client of filteredClients">
    <div class="card-header">

    </div>

    <div class="client-avatar">
      <img *ngIf="client.profil" [src]="'http://localhost:8080' + client.profil"
        style="width: 100%; height:100%; border-radius: 50%; object-fit: cover;">
      <span *ngIf="!client.profil" style="font-weight: bold; color: #3699ff; font-size: 24px;">
        {{ client.nom[0] }}
      </span>
    </div>

    <h3 class="client-name">{{ client.prenom }} {{ client.nom }}</h3>

    <div class="client-info">
      <p class="client-email">{{ client.email }}</p>
      <p class="client-phone">{{ client.telephone }}</p>
    </div>

    <div class="card-actions">
      <button class="btn-action btn-savoir" (click)="onViewClient(client)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        Savoir Plus
      </button>
      <button class="btn-action btn-supprimer" (click)="onDeleteClient(client)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 21l-6-6m0 0l-6-6m6 6l-6 6m6-6l6-6"></path>
        </svg>
        Supprimer
      </button>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" [class.show]="showModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ editingId ? 'Modifier un client' : 'Ajouter un client' }}</h3>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>CIN *</label>
        <input type="text" [(ngModel)]="newClient.cin" name="cin" class="form-control" placeholder="CIN">
      </div>
      <div class="form-group">
        <label>Nom *</label>
        <input type="text" [(ngModel)]="newClient.nom" name="nom" class="form-control" placeholder="Nom">
      </div>
      <div class="form-group">
        <label>Prénom *</label>
        <input type="text" [(ngModel)]="newClient.prenom" name="prenom" class="form-control" placeholder="Prénom">
      </div>
      <div class="form-group">
        <label>Email *</label>
        <input type="email" [(ngModel)]="newClient.email" name="email" class="form-control" placeholder="Email">
      </div>
      <div class="form-group">
        <label>Téléphone</label>
        <input type="tel" [(ngModel)]="newClient.telephone" name="telephone" class="form-control"
          placeholder="Téléphone">
      </div>
      <div class="form-group">
        <label>Adresse</label>
        <textarea [(ngModel)]="newClient.adresse" name="adresse" class="form-control" placeholder="Adresse"></textarea>
      </div>
      <div class="form-group">
        <label>Ville</label>
        <input type="text" [(ngModel)]="newClient.ville" name="ville" class="form-control" placeholder="Ville">
      </div>
      <div class="form-group">
        <label>Pays</label>
        <input type="text" [(ngModel)]="newClient.pays" name="pays" class="form-control" placeholder="Pays">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeModal()">Annuler</button>
      <button class="btn-save" (click)="saveClient()">Enregistrer</button>
    </div>
  </div>
</div>
<div class="modal-backdrop" [class.show]="showModal" (click)="closeModal()"></div>

<!-- View Details Modal (Read-only) -->
<div class="modal view-modal" [class.show]="showViewModal">
  <div class="modal-content view-content">
    <div class="modal-header">
      <h3>Détails du Client</h3>
      <button class="close-btn" (click)="closeViewModal()">&times;</button>
    </div>
    <div class="modal-body view-body" *ngIf="viewingClient">
      <div class="view-group">
        <label>CIN</label>
        <p>{{ viewingClient.cin }}</p>
      </div>
      <div class="view-group">
        <label>Nom</label>
        <p>{{ viewingClient.nom }}</p>
      </div>
      <div class="view-group">
        <label>Prénom</label>
        <p>{{ viewingClient.prenom }}</p>
      </div>
      <div class="view-group">
        <label>Email</label>
        <p>{{ viewingClient.email }}</p>
      </div>
      <div class="view-group">
        <label>Téléphone</label>
        <p>{{ viewingClient.telephone || 'N/A' }}</p>
      </div>
      <div class="view-group">
        <label>Adresse</label>
        <p>{{ viewingClient.adresse || 'N/A' }}</p>
      </div>
      <div class="view-group">
        <label>Ville</label>
        <p>{{ viewingClient.ville || 'N/A' }}</p>
      </div>
      <div class="view-group">
        <label>Pays</label>
        <p>{{ viewingClient.pays || 'N/A' }}</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-close-view" (click)="closeViewModal()">Fermer</button>
    </div>
  </div>
</div>
<div class="modal-backdrop" [class.show]="showViewModal" (click)="closeViewModal()"></div>